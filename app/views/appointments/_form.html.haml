-# frozen_string_literal: true
= simple_form_for(@appointment, defaults: { input_html: { class: "fancy-form__input" } }, html: { class: "fancy-form" }) do |f|
  = f.error_notification
  = f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present?

  - if is_admin?
    = f.input :school_id, as: :select, collection: School.all.drop(1), label: "Escola", input_html: { class: "fancy-form__input fancy-form__select" }
  - else
    = f.input :school_id, as: :hidden, input_html: { value: School.find_by_id(current_user.school.id).id }

  .columns.columns--small
    = f.simple_fields_for :appointment_student do |g|
      .column.column--small.column--small--4{style: "margin-right: 15px"}
        = g.input :name, label: "Nome completo", :url => autocomplete_student_name_appointments_path, :as => :autocomplete, :update_elements => {:classy => '.cid', :groupy => '.gid', :id => ".sid"}
      .column.column--small.column--small--2{style: "margin-right: 15px"}
        = g.input :classy, label: "Ano", input_html: { class: "cid fancy-form__input" }
      .column.column--small.column--small--4
        = g.input :groupy, label: "Turma", input_html: { class: "gid fancy-form__input" }
        = g.input :student_id, as: :hidden, input_html: { class: "sid" }

  .columns.columns--small
    .column.column--small.column--small--5{style: "margin-right: 15px"}
      = f.input :appointment_date, as: :string, label: "Data", input_html: {id: "date-picker", class: "string required fancy-form__input date"} if not action_name == 'edit'
      = f.input :appointment_date, as: :string, label: "Data", input_html: {id: "date-picker", class: "string required fancy-form__input date", value: l(@appointment.appointment_date)} if action_name == 'edit'
    .column.column--small.column--small--5
      = f.input :appointment_time, label: "Hora", input_html: {id: "time-picker"}

  = f.input :reason, label: "Motivo da solicitação", as: :text

  .text-center
    = f.submit "Agendar", class: "button button--green fancy-link--white"

- content_for :javascript do
  :javascript
    $( "#date-picker" ).datepicker({
      dateFormat: "dd/mm/yy",
      prevText: "Anterior",
      nextText: "Próximo",
      monthNames: [ "Janeiro", "Fevereiro", "Março", "Abril", "Março", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro" ],
      dayNamesMin: [ "Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb" ]
    });

    $('#time-picker').timepicker({
      'scrollDefault': 'now',
      'timeFormat': 'H:i'
    });
